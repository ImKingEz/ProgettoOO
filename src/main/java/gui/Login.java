package gui;

import controller.Controller;
import model.Utente;
import model.invalidLoginException;
import model.passwordNotFoundException;
import model.usernameNotFoundException;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;

public class Login {
    private JPanel panelLogin;
    private JPanel panelUsername;
    private JTextField usernameTextField;
    private JPasswordField passwordField;
    private JButton inviaCredenzialiButton;
    private JPanel panelPassword;
    private JPanel panelBotton;
    private JButton tornaAllaHomeButton;
    private JPanel panelBottonTornaHome;
    private static JFrame frame;
    private Controller controller;
    private static JFrame frameChiamante;
    private String usernameInserito;
    private String passwordInserita;
    private Utente u;

    public Login(JFrame frameChiamante, Controller controller) {
        this.frameChiamante = frameChiamante;
        this.controller = controller;
        frame = new JFrame("Area login");
        frame.setContentPane(panelLogin);
        frame.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE); // Evita la chiusura automatica
        frame.addWindowListener(new WindowAdapter() {
            @Override
            public void windowClosing(WindowEvent e) {
                // Logica quando la finestra di inserimento autore sta chiudendo
                // Puoi inserire qui eventuali operazioni di pulizia o gestione della chiusura
                frameChiamante.setVisible(true);
                frame.dispose(); // Chiude la finestra di inserimento autore
            }
        });
        frame.pack();
        frameChiamante.setVisible(false);
        frame.setVisible(true);
        usernameTextField.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
            }
        });
        passwordField.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {

            }
        });
        inviaCredenzialiButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                usernameInserito = usernameTextField.getText();
                char[] passwordChars = passwordField.getPassword();  // per ottenere la password
                passwordInserita = new String(passwordChars);
                String returnLogin = "";
                try {
                    returnLogin = controller.login(usernameInserito, passwordInserita);
                    JOptionPane.showMessageDialog(frame, "Ciao " + usernameInserito + " sei un " + returnLogin);
                    u = controller.controllaIdentita(usernameInserito, passwordInserita, returnLogin);
                    FinestraOpzioni finestraOpzioni = new FinestraOpzioni(frame, controller, u, returnLogin);
                    frame.setVisible(false);
                    frame.dispose();
                } catch (invalidLoginException il) {
                    JOptionPane.showMessageDialog(frame, "Non puoi lasciare un campo vuoto.");
                } catch (usernameNotFoundException unf) {
                    JOptionPane.showMessageDialog(frame, "Username non esistente.");
                } catch (passwordNotFoundException pnf) {
                    JOptionPane.showMessageDialog(frame, "Password errata.");
                }
            }
        });
        tornaAllaHomeButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                frameChiamante.setVisible(true);
                frame.setVisible(false);
                frame.dispose();
            }
        });
    }

    {
// GUI initializer generated by IntelliJ IDEA GUI Designer
// >>> IMPORTANT!! <<<
// DO NOT EDIT OR ADD ANY CODE HERE!
        $$$setupUI$$$();
    }

    /**
     * Method generated by IntelliJ IDEA GUI Designer
     * >>> IMPORTANT!! <<<
     * DO NOT edit this method OR call it in your code!
     *
     * @noinspection ALL
     */
    private void $$$setupUI$$$() {
        panelLogin = new JPanel();
        panelLogin.setLayout(new FlowLayout(FlowLayout.CENTER, 5, 5));
        panelLogin.setMinimumSize(new Dimension(384, 50));
        panelLogin.setPreferredSize(new Dimension(500, 300));
        panelLogin.setVisible(true);
        panelUsername = new JPanel();
        panelUsername.setLayout(new FlowLayout(FlowLayout.CENTER, 5, 5));
        panelUsername.setMinimumSize(new Dimension(138, 40));
        panelUsername.setPreferredSize(new Dimension(138, 40));
        panelLogin.add(panelUsername);
        usernameTextField = new JTextField();
        usernameTextField.setMaximumSize(new Dimension(128, 30));
        usernameTextField.setMinimumSize(new Dimension(128, 30));
        usernameTextField.setPreferredSize(new Dimension(128, 30));
        usernameTextField.setToolTipText("");
        usernameTextField.setVerifyInputWhenFocusTarget(true);
        panelUsername.add(usernameTextField);
        panelPassword = new JPanel();
        panelPassword.setLayout(new FlowLayout(FlowLayout.CENTER, 5, 5));
        panelPassword.setMinimumSize(new Dimension(138, 40));
        panelPassword.setPreferredSize(new Dimension(138, 40));
        panelLogin.add(panelPassword);
        passwordField = new JPasswordField();
        passwordField.setMaximumSize(new Dimension(128, 30));
        passwordField.setMinimumSize(new Dimension(128, 30));
        passwordField.setPreferredSize(new Dimension(128, 30));
        passwordField.setToolTipText("");
        passwordField.setVerifyInputWhenFocusTarget(true);
        panelPassword.add(passwordField);
        panelBotton = new JPanel();
        panelBotton.setLayout(new FlowLayout(FlowLayout.CENTER, 5, 5));
        panelBotton.setMinimumSize(new Dimension(138, 40));
        panelBotton.setPreferredSize(new Dimension(138, 40));
        panelLogin.add(panelBotton);
        inviaCredenzialiButton = new JButton();
        inviaCredenzialiButton.setMaximumSize(new Dimension(128, 30));
        inviaCredenzialiButton.setMinimumSize(new Dimension(128, 30));
        inviaCredenzialiButton.setPreferredSize(new Dimension(128, 30));
        inviaCredenzialiButton.setText("Login");
        panelBotton.add(inviaCredenzialiButton);
        panelBottonTornaHome = new JPanel();
        panelBottonTornaHome.setLayout(new FlowLayout(FlowLayout.CENTER, 5, 5));
        panelLogin.add(panelBottonTornaHome);
        tornaAllaHomeButton = new JButton();
        tornaAllaHomeButton.setText("Torna alla Home");
        panelBottonTornaHome.add(tornaAllaHomeButton);
    }

    /**
     * @noinspection ALL
     */
    public JComponent $$$getRootComponent$$$() {
        return panelLogin;
    }

}
